# 02.部署与运行

参考文章

1. [Installing the apiserver build tools](https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/docs/installing.md)
    - 安装方法
2. [Getting started (using v0.1-alpha.6)](https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/docs/tools_user_guide.md)
3. [Step by step example](https://github.com/kubernetes-sigs/apiserver-builder-alpha/commits/example-simple)
4. [concepts/aggregation](https://github.com/kubernetes-sigs/apiserver-builder-alpha/blob/master/docs/concepts/aggregation.md)
    - `kubectl api-resources`的工作流程
    - 通过创建`APIService`资源注册自定义的资源类型
5. [使用Aggregated APIServer的方式构建API服务](https://jeremyxu2010.github.io/2019/07/%E4%BD%BF%E7%94%A8aggregated-apiserver%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9E%84%E5%BB%BAapi%E6%9C%8D%E5%8A%A1/)
    - 全面的使用手册, 构建流程

在生成代码并编写业务逻辑后, 可以直接通过`go run`启动工程.

需要注意的是, 存在`cmd/apiserver`, `cmd/manager`两个目录, 其中如果单纯的编写CRD项目, 可以使用`cmd/manager`, 至于`cmd/apiserver`, 将在下一篇文章给出.

官方文档中说需要启动`etcd`+`apiserver`+`controller-manager`, 还提供了各种方法, 像本地构建`apiserver`二进制包, 或是通过`minikube`运行什么的. 这里我们不搞那么麻烦, 直接以`kubeadm`构建的`kuber`集群进行实验.

> 在`GOPATH`外运行即可.

```
go run cmd/manager/main.go --kubeconfig /etc/kubernetes/admin.conf 
```

然后创建CRD及CR资源, 就可以进行测试了.

```
kubectl apply -f docs/deploy/04.crd.yaml
kubectl apply -f docs/deploy/05.podcluster.yaml
```

> 00-03的部署文件是给`Aggregated APIServer`用的, 本例中暂时不需要部署.

但是这样的工程并没有太大意义, 普通的CRD用`kubebuilder`就可以搭建出框架, 而`apiserver-builder`最重要的功能是构建`Aggregated APIServer`, 这个将在下篇文章中进行介绍.
